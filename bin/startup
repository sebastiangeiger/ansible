#!/bin/sh
# Copied from https://gist.github.com/dmkash/2355219
if [ -f ".project" ]; then
  source ".project"

  tmux has-session -t "${SESSION_NAME}"
  if [ $? != 0 ]
  then
    echo "Creating the session "${SESSION_NAME}""
    # Create the session and set it up
    # Window 1: vim
    tmux new-session -s "${SESSION_NAME}" -n vim -d
    tmux send-keys -t "${SESSION_NAME}":1 'vim' C-m

    # Window 2: rails server
    tmux new-window -n 'server' -t "${SESSION_NAME}"
    tmux send-keys -t "${SESSION_NAME}":2 'rails s' C-m

    # Window 3: rails console
    tmux new-window -n 'console' -t "${SESSION_NAME}"
    tmux send-keys -t "${SESSION_NAME}":3 'rails c' C-m

    # Window 4: rake routes
    tmux new-window -n 'routes' -t "${SESSION_NAME}"
    tmux send-keys -t "${SESSION_NAME}":4 'rake routes | vim -' C-m

    # Show Window 1
    tmux select-window -t "${SESSION_NAME}":1
  fi
  if !( [ "$TERM" = "screen" ] && [ -n "$TMUX" ] ); then
    tmux attach -t "${SESSION_NAME}"
  fi

else
  echo "Could not find .project in $(pwd)"
fi
